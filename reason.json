{
  "scopeName": "source.reason",
  "fileTypes": [
    "re",
    "rei"
  ],
  "patterns": [
    { "include": "#module-expression-block-item" }
  ],
  "repository": {
    "attribute": {
      "begin": "(?=\\[(@{1,3})[[:space:]]*[[:alpha:]])",
      "end": "\\]",
      "patterns": [
        {
          "begin": "\\[(@{1,3})",
          "end": "(?=[^_\\.'[:word:]])",
          "beginCaptures": {
            "1": { "name": "keyword.other" }
          },
          "patterns": [
            { "include": "#attribute-identifier" }
          ]
        },
        {
          "begin": "(:)",
          "end": "(?=\\])",
          "beginCaptures": {
            "1": { "name": "keyword.operator" }
          },
          "patterns": [
            { "include": "#type-expression" }
          ]
        },
        {
          "begin": "",
          "end": "(?=\\])",
          "patterns": [
            {
              "comment": "FIXME: should be module-items",
              "include": "#value-expression"
            }
          ]
        }
      ]
    },
    "attribute-identifier": {
      "patterns": [
        {
          "match": "\\b([[:alpha:]][[:word:]]*)\\b[[:space:]]*(?:(\\.))",
          "captures": {
            "1": { "name": "entity.name.class" },
            "2": { "name": "keyword.operator" }
          }
        },
        {
          "name": "constant.language",
          "match": "\\b([[:alpha:]][[:word:]]*)\\b"
        }
      ]
    },
    "class-item-inherit": {
      "begin": "\\b(inherit)\\b",
      "end": "(;)",
      "beginCaptures": {
        "1": { "name": "keyword.other" }
      },
      "endCaptures": {
        "1": { "name": "keyword.other" }
      },
      "patterns": [
        { "include": "#value-expression" }
      ]
    },
    "class-item-method": {
      "begin": "\\b(method)\\b",
      "end": "(;)|(?=[\\}])",
      "beginCaptures": {
        "1": { "name": "storage.type.reason" }
      },
      "endCaptures": {
        "1": { "name": "keyword.operator" }
      },
      "patterns": [
        { "include": "#module-item-let-value-bind-name-params-type-body" }
      ]
    },
		"comment": {
			"name": "comment.reason",
			"patterns": [
				{ "include": "#comment-block-doc" },
				{	"include": "#comment-block"	}
			]
		},
		"comment-block": {
			"begin": "/\\*",
			"end": "\\*/",
			"name": "comment.block.reason",
      "patterns": [
        { "include": "#comment" }
      ]
		},
		"comment-block-doc": {
			"begin": "/\\*\\*(?!/)",
			"end": "\\*/",
			"name": "comment.block.documentation.reason",
      "patterns": [
        { "include": "#comment" }
      ]
		},
    "extension-node": {
      "begin": "(?=\\[(%{1,3})[[:space:]]*[[:alpha:]])",
      "end": "\\]",
      "patterns": [
        {
          "begin": "\\[(%{1,3})",
          "end": "(?=[^_\\.'[:word:]])",
          "beginCaptures": {
            "1": { "name": "keyword.other" }
          },
          "patterns": [
            { "include": "#attribute-identifier" }
          ]
        },
        {
          "begin": "(:)",
          "end": "(?=\\])",
          "beginCaptures": {
            "1": { "name": "keyword.operator" }
          },
          "patterns": [
            { "include": "#type-expression" }
          ]
        }
      ]
    },
    "jsx": {
      "comment": "(<)([_[:alpha:]][[:word:]]*(?:\\.[_[:alpha:]][[:word:]]*)*)",
      "begin": "(<)(?=[_[:alpha:]])",
      "end": "(/>)|(?:(</)([_[:alpha:]][[:word:]]*(?:\\.[_[:alpha:]][[:word:]]*)*)(>))",
      "applyEndPatternLast": true,
      "beginCaptures": {
        "1": { "name": "keyword.operator" },
        "2": { "name": "entity.name.function" }
      },
      "endCaptures": {
        "1": { "name": "keyword.operator" },
        "2": { "name": "keyword.operator" },
        "3": { "name": "entity.name.function" },
        "4": { "name": "keyword.operator" }
      },
      "patterns": [
        {
          "begin": "\\G",
          "end": "(?=[[:space:]/>])",
          "patterns": [
            {
              "begin": "\\b([[:upper:]][[:word:]]*)\\b[[:space:]]*(\\.)",
              "end": "(?=[[:space:]/>])",
              "beginCaptures": {
                "1": { "name": "entity.name.class" },
                "2": { "name": "keyword.operator" }
              },
              "patterns": [
                {
                  "comment": "FIXME: make into named pattern",
                  "match": "(?:\\G|^)[[:space:]]*\\b([_[:upper:]][[:word:]]*)\\b",
                  "name": "name.entity.class"
                },
                {
                  "comment": "FIXME: make into named pattern",
                  "match": "(?:\\G|^)[[:space:]]*\\b([_[:lower:]][[:word:]]*)\\b",
                  "name": "name.entity.function"
                }
              ]
            },
            {
              "comment": "FIXME: make into named pattern",
              "match": "(?:\\G|^)[[:space:]]*\\b([_[:upper:]][[:word:]]*)\\b",
              "name": "name.entity.class"
            },
            {
              "comment": "FIXME: make into named pattern",
              "match": "(?:\\G|^)[[:space:]]*\\b([_[:lower:]][[:word:]]*)\\b",
              "name": "name.entity.function"
            }
          ]
        },
        { "include": "#jsx-attributes" },
        { "include": "#jsx-body" }
      ]
    },
    "jsx-attributes": {
      "patterns": [
        {
          "begin": "\\b([[:lower:]][[:word:]]*)\\b[[:space:]]*(=)",
          "end": "(?<![=])(?=[/>[:lower:]])",
          "beginCaptures": {
            "1": { "name": "constant.language" },
            "2": { "name": "keyword.other" }
          },
          "patterns": [
            { "include": "#value-expression-atomic" }
          ]
        },
        {
          "match": "\\b([[:lower:]][[:word:]]*)\\b",
          "name": "constant.language"
        }
      ]
    },
    "jsx-body": {
      "begin": "(>)",
      "end": "(?=</)",
      "beginCaptures": {
        "1": { "name": "keyword.operator" }
      },
      "patterns": [
        {
          "comment": "FIXME: seems necessary in order to properly tokenize `[[:word:]]</` boundary",
          "match": "[[:lower:]][[:word:]]*"
        },
        { "include": "#value-expression" }
      ]
    },
    "module-expression": {
      "end": "(?=[;])",
      "patterns": [
        { "include": "#comment" },
        {
          "begin": "(?<=\\()",
          "end": "(?=\\))",
          "patterns": [
            {
              "begin": "\\b(val)\\b",
              "end": "(?=\\))",
              "beginCaptures": {
                "1": { "name": "keyword.other" }
              },
              "patterns": [
                { "include": "#module-expression-path" }
              ]
            },
            {
              "begin": "",
              "end": "(?=[:])",
              "patterns": [
                {
                  "match": "\\b([[:upper:]][[:word:]]*)\\b",
                  "name": "entity.name.class"
                }
              ]
            },
            {
              "begin": "([:])",
              "end": "(?=[\\)])",
              "beginCaptures": {
                "1": { "name": "keyword.other" }
              },
              "patterns": [
                { "include": "#signature-expression" }
              ]
            }
          ]
        },
        { "include": "#module-expression-path" },
        { "include": "#module-expression-block" },
        { "include": "#module-expression-constraints" }
      ]
    },
    "module-expression-block": {
      "begin": "\\{",
      "end": "\\}",
      "patterns": [
        { "include": "#module-expression-block-item" }
      ]
    },
    "module-expression-block-item": {
      "patterns": [
        { "include": "#attribute" },
        { "include": "#comment" },
        { "include": "#module-item-exception" },
        { "include": "#module-item-include" },
        { "include": "#module-item-let" },
        { "include": "#module-item-class-type" },
        { "include": "#module-item-module-type" },
        { "include": "#module-item-module" },
        { "include": "#module-item-open" },
        { "include": "#module-item-type" }
      ]
    },
    "module-expression-constraints": {
      "begin": "(?=\\b(with))",
      "end": "(?=[;\\)])",
      "patterns": [
        {
          "begin": "\\b(and|with)\\b",
          "end": "(?=\\b(and|with)\\b|[;\\)])",
          "beginCaptures": {
            "1": { "name": "storage.modifier" }
          },
          "patterns": [
            { "include": "#module-item-type" },
            {
              "begin": "(?=\\b(module)\\b)",
              "end": "(?=\\b(and|with)\\b|[;\\)])",
              "patterns": [
                {
                  "begin": "\\b(module)\\b",
                  "end": "(?=:?=)",
                  "patterns": [
                    { "include": "#module-expression-path" },
                    {
                      "match": "[[:upper:]][[:word:]]*",
                      "name": "entity.name.class"
                    }
                  ],
                  "beginCaptures": {
                    "1": { "name": "storage.type" }
                  }
                },
                {
                  "begin": "(:=)",
                  "end": "(?=\\b(and|with)\\b|[;\\)])",
                  "patterns": [
                    { "include": "#module-expression" }
                  ],
                  "beginCaptures": {
                    "1": { "name": "keyword.other" }
                  }
                }
              ]
            }
          ]
        }
      ]
    },
    "module-expression-path": {
      "patterns": [
        { "include": "#module-expression-path-prefix" },
        {
          "match": "\\b[[:upper:]][[:word:]]*\\b",
          "name": "entity.name.class"
        }
      ]
    },
    "module-expression-path-prefix": {
      "begin": "\\b([[:upper:]][[:word:]]*)\\b[[:space:]]*(?=(\\(.*\\))*\\.)",
      "end": "(\\.)|(?=[;\\)])",
      "beginCaptures": {
        "1": { "name": "entity.name.class" }
      },
      "endCaptures": {
        "1": { "name": "keyword.operator" }
      },
      "patterns": [
        {
          "begin": "(\\()",
          "end": "(\\))",
          "captures": {
            "1": { "name": "keyword.other" }
          },
          "patterns": [
            { "comment": "FIXME: make a new rule for these" },
            { "include": "#module-expression-path" },
            { "include": "#module-expression-block" },
            { "include": "#module-expression-constraints" }
          ]
        }
      ]
    },
    "module-expression-path-prefix-simple": {
      "begin": "\\b([[:upper:]][[:word:]]*)\\b[[:space:]]*(?=[\\.])",
      "end": "(\\.)",
      "beginCaptures": {
        "1": { "name": "entity.name.class" }
      },
      "endCaptures": {
        "1": { "name": "keyword.operator" }
      },
      "patterns": [
        {
          "match": "\\b[[:upper:]][[:word:]]*\\b",
          "name": "entity.name.class"
        }
      ]
    },
    "module-item-class-type": {
      "comment": "FIXME: proper parsing",
      "begin": "\\b(class)\\b",
      "end": "(;)",
      "beginCaptures": {
        "1": { "name": "keyword.other" }
      },
      "endCaptures": {
        "1": { "name": "keyword.other" }
      },
      "patterns": [
        {
          "begin": "(?:\\G|^)[[:space:]]*\\b(type)\\b",
          "end": "(?==)",
          "beginCaptures": {
            "1": { "name": "keyword.other" }
          },
          "patterns": [
            { "include": "#module-item-type-bind-name-tyvars" }
          ]
        },
        {
          "begin": "(=)",
          "end": "(?=;)",
          "beginCaptures": {
            "1": { "name": "keyword.other" }
          },
          "patterns": [
            { "include": "#attribute" },
            { "include": "#comment" },
            { "include": "#class-item-inherit" },
            { "include": "#class-item-method" }
          ]
        }
      ]
    },
    "module-item-exception": {
      "begin": "\\b(exception)\\b",
      "end": "(;)",
      "beginCaptures": {
        "1": { "name": "keyword.other" }
      },
      "endCaptures": {
        "1": { "name": "keyword.other" }
      },
      "patterns": [
        { "include": "#module-item-type-bind-body-item" }
      ]
    },
    "module-item-include": {
      "begin": "\\b(include)\\b",
      "end": "(;)",
      "beginCaptures": {
        "1": { "name": "keyword.other" }
      },
      "endCaptures": {
        "1": { "name": "keyword.other" }
      },
      "patterns": [
        { "include": "#module-expression" }
      ]
    },
    "module-item-let": {
      "comment": "FIXME: move external to separate rule",
      "begin": "\\b(external|let)\\b",
      "end": "(;)|(?=[\\}])",
      "beginCaptures": {
        "1": { "name": "storage.type.reason" }
      },
      "endCaptures": {
        "1": { "name": "keyword.operator" }
      },
      "patterns": [
        { "include": "#module-item-let-module" },
        { "include": "#module-item-let-value" }
      ]
    },
    "module-item-let-module": {
      "begin": "(?:\\G|^)[[:space:]]*\\b(module)\\b",
      "end": "(?=[;\\}])",
      "beginCaptures": {
        "1": { "name": "storage.type.reason" }
      },
      "patterns": [
        { "include": "#module-item-let-module-and" },
        { "include": "#module-item-let-module-rec" },
        { "include": "#module-item-let-module-bind-name-params-type-body" }
      ]
    },
    "module-item-let-module-and": {
      "begin": "\\b(and)\\b",
      "end": "(?=\\b(and)\\b|[;\\}])",
      "beginCaptures": {
        "1": { "name": "storage.type.reason" }
      },
      "patterns": [
        { "include": "#module-item-let-module-bind-name-params-type-body" }
      ]
    },
    "module-item-let-module-bind-body": {
      "begin": "(=>?)",
      "end": "(?=\\b(and)\\b|[;\\}])",
      "beginCaptures": {
        "1": { "name": "keyword.operator.reason" }
      },
      "patterns": [
        { "include": "#module-expression" }
      ]
    },
    "module-item-let-module-bind-name-params": {
      "begin": "\\b([[:upper:]][[:word:]]*)\\b",
      "end": "(?=[:=])",
      "beginCaptures": {
        "1": { "name": "entity.name.class" }
      },
      "patterns": [
        { "include": "#comment" },
        { "include": "#module-item-let-module-param" }
      ]
    },
    "module-item-let-module-bind-name-params-type-body": {
      "begin": "(?:\\G|^)",
      "end": "(?=\\b(and)\\b|[;\\}])",
      "patterns": [
        { "include": "#comment" },
        { "include": "#module-item-let-module-bind-name-params" },
        { "include": "#module-item-let-module-bind-type" },
        { "include": "#module-item-let-module-bind-body" }
      ]
    },
    "module-item-let-module-bind-type": {
      "begin": "(:)",
      "end": "(?=\\b(and)\\b|[;\\}=])",
      "beginCaptures": {
        "1": { "name": "keyword.operator.reason" }
      },
      "patterns": [
        { "include": "#signature-expression" }
      ]
    },
    "module-item-let-module-param": {
      "begin": "(?=\\()",
      "end": "\\)",
      "patterns": [
        {
          "begin": "\\(",
          "end": "(?=[:])",
          "patterns": [
            { "include": "#comment" },
            { "include": "#module-expression-path" }
          ]
        },
        {
          "begin": "(:)",
          "end": "(?=\\))",
          "beginCaptures": {
            "1": { "name": "keyword.other" }
          },
          "patterns": [
            { "include": "#module-expression" }
          ]
        }
      ]
    },
    "module-item-let-module-rec": {
      "begin": "(?:\\G|^)[[:space:]]*\\b(rec)\\b",
      "end": "(?=\\b(and)\\b|[;\\}])",
      "beginCaptures": {
        "1": { "name": "storage.modifier.rec.reason" }
      },
      "patterns": [
        { "include": "#module-item-let-module-bind-name-params-type-body" }
      ]
    },
    "module-item-let-value": {
      "patterns": [
        { "include": "#module-item-let-value-and" },
        { "include": "#module-item-let-value-rec" },
        { "include": "#module-item-let-value-bind-name-params-type-body" }
      ]
    },
    "module-item-let-value-and": {
      "begin": "\\b(and)\\b",
      "end": "(?=\\b(and)\\b|[;\\}])",
      "beginCaptures": {
        "1": { "name": "storage.type.reason" }
      },
      "patterns": [
        { "include": "#module-item-let-value-bind-name-params-type-body" }
      ]
    },
    "module-item-let-value-bind-body": {
      "begin": "(=>?)",
      "end": "(?=\\b(and)\\b|[;\\)\\}])",
      "beginCaptures": {
        "1": { "name": "keyword.operator.reason" }
      },
      "patterns": [
        { "include": "#value-expression" }
      ]
    },
    "module-item-let-value-bind-name-params": {
      "begin": "(?:\\G|^)[[:space:]]*(?!\\blazy\\b)(?!\\blet\\b)(?:\\b([_][[:word:]]+)\\b|\\b([[:lower:]][[:word:]]+)\\b)",
      "end": "(?<!:)(?!::)(?=[:=])",
      "beginCaptures": {
        "1": { "name": "comment.line" },
        "2": { "name": "entity.name.function" }
      },
      "patterns": [
        { "include": "#module-item-let-value-param" }
      ]
    },
    "module-item-let-value-bind-name-params-type-body": {
      "begin": "(?!\\b(module|rec)\\b)",
      "end": "(?=\\b(and)\\b|[;\\}])",
      "patterns": [
        { "include": "#module-item-let-value-bind-name-params" },
        { "include": "#module-item-let-value-bind-pattern" },
        { "include": "#module-item-let-value-bind-type" },
        { "include": "#module-item-let-value-bind-body" }
      ]
    },
    "module-item-let-value-bind-parens-params": {
      "begin": "(?=\\([^\\)])",
      "end": "(?!::)(?=[:=])",
      "patterns": [
        {
          "begin": "\\G\\(",
          "end": "\\)",
          "patterns": [
            { "include": "#operator-infix-custom" },
            { "include": "#pattern" },
            { "include": "#pattern-parens-lhs" },
            { "include": "#pattern-parens-rhs" }
          ]
        },
        { "include": "#module-item-let-value-param" }
      ]
    },
    "module-item-let-value-bind-pattern": {
      "begin": "",
      "end": "(?==)",
      "patterns": [
        { "include": "#module-item-let-value-bind-parens-params" },
        { "include": "#pattern" }
      ]
    },
    "module-item-let-value-bind-type": {
      "comment": "FIXME: lookahead",
      "begin": "(:)",
      "end": "(?=\\b(and)\\b|[;\\}]|=(?!>))",
      "beginCaptures": {
        "1": { "name": "keyword.operator.reason" }
      },
      "patterns": [
        { "include": "#type-expression" }
      ]
    },
    "module-item-let-value-param": {
      "patterns": [
        { "include": "#module-item-let-value-param-label" },
        { "include": "#module-item-let-value-param-type" },
        { "include": "#module-item-let-value-param-module" },
        { "include": "#pattern" }
      ]
    },
    "module-item-let-value-param-label": {
      "patterns": [
        {
          "begin": "\\b([[:lower:]][[:word:]]*)\\b(::)",
          "end": "(?<=[[:space:]])",
          "beginCaptures": {
            "1": { "name": "constant.language" },
            "2": { "name": "keyword.other" }
          },
          "patterns": [
            { "include": "#pattern" },
            {
              "begin": "(=)",
              "end": "(\\?)|(?=[[:space:]])",
              "beginCaptures": {
                "1": { "name": "keyword.other" }
              },
              "endCaptures": {
                "1": { "name": "storage.type" }
              },
              "patterns": [
                { "include": "#value-expression" }
              ]
            }
          ]
        }
      ]
    },
    "module-item-let-value-param-module": {
      "comment": "FIXME: merge with pattern-parens",
      "begin": "\\([[:space:]]*(?=\\b(module)\\b)",
      "end": "\\)",
      "patterns": [
        {
          "begin": "\\b(module)\\b",
          "end": "(?=\\))",
          "beginCaptures": {
            "1": { "name": "keyword.other" }
          },
          "patterns": [
            {
              "match": "\\b[[:upper:]][[:word:]]*\\b",
              "name": "entity.name.class"
            }
          ]
        }
      ]
    },
    "module-item-let-value-param-type": {
      "comment": "FIXME: merge with pattern-parens",
      "begin": "\\((?=\\b(type)\\b)",
      "end": "\\)",
      "patterns": [
        {
          "begin": "\\b(type)\\b",
          "end": "(?=\\))",
          "beginCaptures": {
            "1": { "name": "keyword.other" }
          },
          "patterns": [
            {
              "name": "support.type",
              "match": "\\b[[:lower:]][[:word:]]*\\b"
            }
          ]
        }
      ]
    },
    "module-item-let-value-rec": {
      "begin": "(?:\\G|^)[[:space:]]*\\b(rec)\\b",
      "end": "(?=\\b(and)\\b|[;\\}])",
      "beginCaptures": {
        "1": { "name": "storage.modifier.rec.reason" }
      },
      "patterns": [
        { "include": "#module-item-let-value-bind-name-params-type-body" }
      ]
    },
    "module-item-module": {
      "comment": "NOTE: this is to support the let-module case without the let prefix",
      "begin": "\\b(module)\\b[[:space:]]*(?!\\b(type)\\b|$)",
      "end": "(;)",
      "beginCaptures": {
        "1": { "name": "storage.type.reason" }
      },
      "endCaptures": {
        "1": { "name": "keyword.operator" }
      },
      "patterns": [
        { "include": "#module-item-let-module-and" },
        { "include": "#module-item-let-module-rec" },
        { "include": "#module-item-let-module-bind-name-params-type-body" }
      ]
    },
    "module-item-module-type": {
      "begin": "\\b(module)\\b[[:space:]]*(?=\\b(type)\\b|$)",
      "end": "(;)",
      "beginCaptures": {
        "1": { "name": "keyword.other" }
      },
      "endCaptures": {
        "1": { "name": "keyword.other" }
      },
      "patterns": [
        {
          "begin": "(?:\\G|^)[[:space:]]*\\b(type)\\b",
          "end": "(?==)",
          "beginCaptures": {
            "1": { "name": "keyword.other" }
          },
          "patterns": [
            { "include": "#comment" },
            {
              "match": "([[:upper:]][[:word:]]*)",
              "captures": {
                "1": { "name": "entity.name.class" }
              }
            }
          ]
        },
        {
          "begin": "(=)",
          "end": "(?=;)",
          "beginCaptures": {
            "1": { "name": "keyword.other" }
          },
          "patterns": [
            { "include": "#comment" },
            { "include": "#module-expression" }
          ]
        }
      ]
    },
    "module-item-open": {
      "begin": "\\b(open)\\b",
      "end": "(;)",
      "beginCaptures": {
        "1": { "name": "keyword.other" }
      },
      "endCaptures": {
        "1": { "name": "keyword.other" }
      },
      "patterns": [
        { "include": "#comment" },
        { "include": "#module-expression-path" },
        {
          "match": "[[:upper:]][[:word:]]*",
          "name": "entity.name.class"
        }
      ]
    },
    "module-item-type": {
      "comment": "FIXME: the semi-colon is optional so we can re-use this for hover, which does not print the trailing ;",
      "begin": "\\b(type)\\b",
      "end": "(?=([;]))|(?=[\\)\\}]|\\b(with)\\b)",
      "beginCaptures": {
        "1": { "name": "keyword.other" }
      },
      "endCaptures": {
        "1": { "name": "keyword.other" }
      },
      "patterns": [
        { "include": "#module-item-type-and" },
        { "include": "#module-item-type-constraint" },
        { "include": "#module-item-type-bind" }
      ]
    },
    "module-item-type-and": {
      "comment": "FIXME: the optional `type` is for module constraints",
      "begin": "\\b(and)\\b([[:space:]]*type)?",
      "end": "(?=\\b(and|with)\\b|[;\\)\\}])",
      "beginCaptures": {
        "1": { "name": "keyword.other" },
        "2": { "name": "keyword.other" }
      },
      "patterns": [
        { "include": "#module-item-type-bind-name-tyvars-body" }
      ]
    },
    "module-item-type-bind": {
      "comment": "FIXME: only allow module paths before type variables",
      "patterns": [
        { "include": "#module-item-type-bind-nonrec" },
        { "include": "#module-item-type-bind-name-tyvars-body" }
      ]
    },
    "module-item-type-bind-body": {
      "comment": "FIXME: parsing",
      "begin": "(\\+?=)",
      "end": "(?=\\b(and|constraint|with)\\b|[;\\)\\}])",
      "beginCaptures": {
        "1": { "name": "keyword.operator.reason" }
      },
      "patterns": [
        { "include": "#module-item-type-bind-body-item" }
      ]
    },
    "module-item-type-bind-body-item": {
      "patterns": [
        {
          "comment": "FIXME: add separate rule; parsing",
          "match": "(?:\\G|^)[[:space:]]*\\b(private)\\b",
          "captures": {
            "1": { "name": "keyword.other" }
          }
        },
        {
          "begin": "(\\.\\.)",
          "end": "(?=[;\\}]|\\b(with)\\b)",
          "beginCaptures": {
            "1": { "name": "keyword.other" }
          }
        },
        {
          "begin": "([\\|])",
          "beginCaptures": {
            "1": { "name": "keyword.other" }
          },
          "end": "(?=\\b(and|constraint|with)\\b|[;\\)\\}\\|])",
          "patterns": [
            {
              "begin": "(?<=[=\\|])",
              "end": "\\b([[:upper:]][[:word:]]*)\\b[[:space:]]*+",
              "endCaptures": {
                "1": { "name": "constant.language" }
              }
            },
            {
              "begin": "[[:space:]]*+",
              "end": "(?=\\b(and|constraint|with)\\b|[;\\)\\}\\|])",
              "beginCaptures": {
                "1": { "name": "keyword.other" }
              },
              "patterns": [
                {
                  "match": "\\b(of)\\b",
                  "name": "keyword.other"
                },
                { "include": "#type-expression" }
              ]
            }
          ]
        },
        {
          "comment": "FIXME: remove this once the pretty printer no longer outputs 'of'",
          "match": "[:|]|\\b(of)\\b",
          "name": "keyword.other"
        },
        { "include": "#type-expression" },
        { "include": "#value-expression-literal-constructor-variant" }
      ]
    },
    "module-item-type-bind-nonrec": {
      "begin": "(?:\\G|^)[[:space:]]*\\b(nonrec)\\b",
      "end": "(?=\\b(and|with)\\b|[;\\)\\}])",
      "beginCaptures": {
        "1": { "name": "storage.modifier.nonrec.reason" }
      },
      "patterns": [
        { "include": "#module-item-type-bind-name-tyvars-body" }
      ]
    },
    "module-item-type-bind-name-tyvars": {
      "begin": "(?<=\\G|^|\\.)[[:space:]]*\\b([[:lower:]][[:word:]]*)\\b",
      "end": "(?=\\+?=|[;\\)\\}]|\\b(with)\\b)",
      "beginCaptures": {
        "1": { "name": "entity.name.function" }
      },
      "patterns": [
        { "include": "#comment" },
        { "include": "#attribute" },
        {
          "match": "_",
          "name": "comment.line"
        },
        {
          "comment": "FIXME: add separate type-variable rule",
          "match": "([+\\-])?(?:(_)|'([[:lower:]][[:word:]]*)\\b)(?!\\.[[:upper:]])",
          "captures": {
            "1": { "name": "keyword.other" },
            "2": { "name": "comment.line" },
            "3": { "name": "variable.parameter" }
          }
        }
      ]
    },
    "module-item-type-bind-name-tyvars-body": {
      "begin": "(?=(\\G|^)[[:space:]]*\\b[[:alpha:]])",
      "end": "(?=\\b(and|constraint|with)\\b|[;\\)\\}])",
      "patterns": [
        { "include": "#module-expression-path-prefix" },
        { "include": "#module-item-type-bind-name-tyvars" },
        { "include": "#module-item-type-bind-body" }
      ]
    },
    "module-item-type-constraint": {
      "comment": "FIXME: proper parsing",
      "begin": "\\b(constraint)\\b",
      "end": "(?=\\b(and|constraint|with)\\b|[;\\)\\}])",
      "beginCaptures": {
        "1": { "name": "keyword.other" }
      },
      "patterns": [
        {
          "comment": "FIXME: add separate type-variable rule",
          "match": "([+\\-])?'([_[:lower:]][[:word:]]*)\\b(?!\\.[[:upper:]])",
          "captures": {
            "1": { "name": "keyword.other" },
            "2": { "name": "variable.parameter" }
          }
        },
        {
          "match": "=",
          "name": "keyword.other"
        },
        { "include": "#type-expression" }
      ]
    },
    "pattern": {
      "patterns": [
        { "include": "#pattern-atomic" },
        {
          "match": "[[:space:]]*+(\\bas\\b|\\|)[[:space:]]*+",
          "captures": {
            "1": { "name": "keyword.other" }
          }
        }
      ]
    },
    "pattern-atomic": {
      "patterns": [
        { "include": "#module-expression-path-prefix-simple" },
        { "include": "#value-expression-literal" },
        { "include": "#pattern-list" },
        { "include": "#pattern-record" },
        { "include": "#pattern-variable" },
        { "include": "#pattern-parens" }
      ]
    },
    "pattern-guard": {
      "begin": "\\b(when)\\b",
      "end": "(?==>)",
      "beginCaptures": {
        "1": { "name": "keyword.other" }
      },
      "patterns": [
        { "include": "#value-expression" }
      ]
    },
    "pattern-list": {
      "begin": "(\\[)(?![@%])",
      "end": "(\\])",
      "beginCaptures": {
        "1": { "name": "constant.language.list.reason" }
      },
      "endCaptures": {
        "1": { "name": "constant.language.list.reason" }
      },
      "patterns": [
        { "include": "#value-expression-literal-list-separator" },
        { "include": "#pattern" }
      ]
    },
    "pattern-parens": {
      "begin": "(?=\\()",
      "end": "\\)",
      "patterns": [
        { "include": "#pattern-parens-lhs" },
        { "include": "#type-annotation-rhs" }
      ]
    },
    "pattern-parens-lhs": {
      "begin": "(?:\\(|(,))",
      "end": "(?=(?:[,:\\)]))",
      "beginCaptures": {
        "1": { "name": "keyword.operator" }
      },
      "patterns": [
        { "include": "#pattern" }
      ]
    },
    "pattern-parens-rhs": {
      "patterns": [
        { "include": "#type-annotation-rhs" }
      ]
    },
    "pattern-record": {
      "begin": "\\{",
      "end": "\\}",
      "patterns": [
        { "include": "#comment" },
        { "include": "#pattern-record-item" }
      ]
    },
    "pattern-record-field": {
      "begin": "\\b([_][[:word:]]*)\\b|\\b([[:lower:]][[:word:]]*)\\b",
      "end": "(?:(,)|(?=\\}))",
      "beginCaptures": {
        "1": { "name": "comment.line" },
        "2": { "name": "constant.language.field.reason" }
      },
      "endCaptures": {
        "1": { "name": "keyword.operator.reason" }
      },
      "patterns": [
        { "include": "#comment" },
        {
          "begin": "\\G(:)",
          "end": "(?=[,\\}])",
          "beginCaptures": {
            "1": { "name": "keyword.operator.reason" }
          },
          "patterns": [
            { "include": "#pattern" }
          ]
        }
      ]
    },
    "pattern-record-item": {
      "patterns": [
        { "include": "#module-expression-path-prefix-simple" },
        { "include": "#pattern-record-field" }
      ]
    },
    "pattern-variable": {
      "patterns": [
        {
          "match": "\\b(_(?:[[:lower:]][[:word:]]*)?)\\b(?!\\.[[:upper:]])",
          "captures": {
            "1": { "name": "comment.line" }
          }
        },
        {
          "match": "\\b([[:lower:]][[:word:]]*)\\b(?!\\.[[:upper:]])",
          "captures": {
            "1": { "name": "variable.parameter" }
          }
        }
      ]
    },
    "object-item": {
      "begin": "(?:\\G|(;))",
      "end": "(?=[;\\}])",
      "beginCaptures": {
        "1": { "name": "keyword.operator" }
      },
      "patterns": [
        { "include": "#class-item-method" }
      ]
    },
    "operator": {
      "patterns": [
        { "include": "#operator-infix" },
        { "include": "#operator-prefix" }
      ]
    },
    "operator-infix-builtin": {
      "name": "keyword.operator",
      "match": ":="
    },
    "operator-infix": {
      "patterns": [
        {
          "match": ";",
          "name": "keyword.other"
        },
        { "include": "#operator-infix-builtin" },
        { "include": "#operator-infix-custom" },
        { "comment": "#operator-infix-custom-hash" }
      ]
    },
    "operator-infix-custom": {
      "name": "keyword.operator",
      "match": "[#\\-@*/&%^+<=>|$][#\\-:!?.@*/&%^+<=>|~$\\\\]*"
    },
    "operator-infix-custom-hash": {
      "name": "keyword.operator",
      "match": "#[\\-:!?.@*/&%^+<=>|~$]+"
    },
    "operator-prefix": {
      "patterns": [
        { "include": "#operator-prefix-bang" },
        { "include": "#operator-prefix-label-token" }
      ]
    },
    "operator-prefix-bang": {
      "name": "keyword.operator",
      "match": "![\\-:!?.@*/&%^+<=>|~$]*"
    },
    "operator-prefix-label-token": {
      "name": "keyword.operator",
      "match": "[?~][\\-:!?.@*/&%^+<=>|~$]+"
    },
    "signature-expression": {
      "patterns": [
        {
          "comment": "FIXME: scan for :upper: to disambiguate type/signature in hover",
          "begin": "(?=\\([[:space:]]*[[:upper:]][[:word:]]*[[:space:]]*:)",
          "end": "(?=[;])",
          "patterns": [
            {
              "begin": "",
              "end": "(?==>)",
              "patterns": [
                { "include": "#module-item-let-module-param" }
              ]
            },
            {
              "begin": "(=>)",
              "end": "(?=[;\\(])",
              "beginCaptures": {
                "1": { "name": "keyword.other" }
              },
              "patterns": [
                { "include": "#module-expression" }
              ]
            }
          ]
        },
        {
          "begin": "\\b(module)\\b[[:space:]]*\\b(type)\\b([[:space:]]*\\b(of)\\b)?",
          "end": "(?=[;\\)\\}]|\\b(with)\\b)",
          "beginCaptures": {
            "1": { "name": "keyword.other" },
            "2": { "name": "keyword.other" },
            "3": { "name": "keyword.other" }
          },
          "patterns": [
            { "include": "#module-expression-path" },
            {
              "match": "\\b([[:upper:]][[:word:]]*)\\b",
              "name": "entity.name.class"
            }
          ]
        },
        { "include": "#module-expression" }
      ]
    },
    "type-annotation-rhs": {
      "begin": "(:)",
      "end": "(?=\\))",
      "beginCaptures": {
        "1": { "name": "keyword.operator" }
      },
      "patterns": [
        { "include": "#type-expression" }
      ]
    },
    "type-expression": {
      "comments": "FIXME: higher-rank, objects, poly-variants, etc.",
      "patterns": [
        { "include": "#attribute" },
        { "include": "#comment" },
        { "include": "#module-expression-path-prefix" },
        { "include": "#type-expression-label" },
        { "include": "#type-expression-arrow" },
        { "include": "#type-expression-constructor" },
        { "include": "#type-expression-object" },
        { "include": "#type-expression-parens" },
        { "include": "#type-expression-polymorphic-variant" },
        { "include": "#type-expression-record" },
        { "include": "#type-expression-variable" }
      ]
    },
    "type-expression-arrow": {
      "name": "keyword.operator",
      "match": "=>"
    },
    "type-expression-constructor": {
      "match": "(_)(?![[:alnum:]])|\\b([_[:lower:]][[:word:]]*)\\b(?!\\.[[:upper:]])",
      "captures": {
        "1": { "name": "variable.parameter" },
        "2": { "name": "support.type" }
      }
    },
    "type-expression-label": {
      "begin": "\\b([_[:lower:]][[:word:]]*)\\b(::)",
      "end": "(?<==>)",
      "beginCaptures": {
        "1": { "name": "constant.language" },
        "2": { "name": "keyword.other" }
      },
      "patterns": [
        { "include": "#type-expression" },
        {
          "match": "(\\?)",
          "captures": {
            "1": { "name": "keyword.other" }
          }
        }
      ]
    },
    "type-expression-object": {
      "comment": "FIXME: separate sub-rules",
      "begin": "(<)",
      "end": "(>)",
      "captures": {
        "1": { "name": "entity.name.function" }
      },
      "patterns": [
        {
          "begin": "(\\.\\.)",
          "end": "(?=>)",
          "beginCaptures": {
            "1": { "name": "constant.language" }
          }
        },
        {
          "comment": "FIXME: method item",
          "begin": "(?=[_[:lower:]])",
          "end": "(,)|(?=>)",
          "endCaptures": {
            "1": { "name": "keyword.other" }
          },
          "patterns": [
            {
              "comment": "FIXME: method name",
              "begin": "(?=[_[:lower:]])",
              "end": "(?=:)",
              "patterns": [
                {
                  "match": "\\b([_[:lower:]][[:word:]]*)\\b",
                  "captures": {
                    "1": { "name": "constant.language" }
                  }
                }
              ]
            },
            {
              "comment": "FIXME: method type",
              "begin": "(:)",
              "end": "(?=[,>])",
              "beginCaptures": {
                "1": { "name": "keyword.other" }
              },
              "patterns": [
                { "include": "#type-expression" }
              ]
            }
          ]
        }
      ]
    },
    "type-expression-parens": {
      "comment": "FIXME: proper tuple types",
      "begin": "\\(",
      "end": "\\)",
      "patterns": [
        {
          "begin": "\\b(module)\\b",
          "end": "(?=[\\)])",
          "beginCaptures": {
            "1": { "name": "keyword.other" }
          },
          "patterns": [
            {
              "begin": "(?=[[:upper:]])",
              "end": "(?=\\b(with)\\b)",
              "patterns": [
                {
                  "match": "\\b([[:upper:]][[:word:]]*)\\b",
                  "name": "entity.name.class"
                }
              ]
            },
            { "include": "#module-expression-constraints" }
          ]
        },
        {
          "match": ",",
          "name": "keyword.other"
        },
        { "include": "#type-expression" }
      ]
    },
    "type-expression-polymorphic-variant": {
      "comment": "FIXME: proper parsing",
      "begin": "(\\[)",
      "end": "(\\])",
      "captures": {
        "1": { "name": "entity.name.function" }
      },
      "patterns": [
        {
          "match": "[<>|]|\\b(of)\\b",
          "name": "keyword.other"
        },
        { "include": "#value-expression-literal-constructor-variant-polymorphic" },
        { "include": "#type-expression" }
      ]
    },
    "type-expression-record": {
      "begin": "\\{",
      "end": "\\}",
      "patterns": [
        { "include": "#type-expression-record-item" }
      ]
    },
    "type-expression-record-field": {
      "comment": "FIXME: proper chaining with mutable, …",
      "begin": "(\\bmutable\\b)?[[:space:]]*(?!\\bmutable\\b)\\b([_[:lower:]][[:word:]]*)\\b",
      "end": "(?:(,)|(?=\\}))",
      "beginCaptures": {
        "1": { "name": "keyword.other" },
        "2": { "name": "constant.language.field.reason" }
      },
      "endCaptures": {
        "1": { "name": "keyword.operator.reason" }
      },
      "patterns": [
        { "include": "#comment" },
        {
          "begin": "(:)",
          "end": "(?=[,\\}])",
          "beginCaptures": {
            "1": { "name": "keyword.operator.reason" }
          },
          "patterns": [
            { "include": "#type-expression" }
          ]
        }
      ]
    },
    "type-expression-record-item": {
      "patterns": [
        { "include": "#comment" },
        { "include": "#module-expression-path-prefix" },
        { "include": "#type-expression-record-field" }
      ]
    },
    "type-expression-variable": {
      "match": "'([_[:lower:]][[:word:]]*)\\b(?!\\.[[:upper:]])",
      "captures": {
        "1": { "name": "parameter.variable" }
      }
    },
    "value-expression": {
      "patterns": [
        { "include": "#attribute" },
        { "include": "#comment" },
        { "include": "#extension-node" },
        { "include": "#module-expression-path-prefix-simple" },
        { "include": "#jsx" },
        { "include": "#operator" },
        { "include": "#value-expression-builtin" },
        { "include": "#value-expression-if-then-else" },
        { "include": "#value-expression-atomic" },
        { "include": "#value-expression-record-path" }
      ]
    },
    "value-expression-atomic": {
      "patterns": [
        { "include": "#value-expression-literal" },
        { "include": "#value-expression-literal-list" },
        { "include": "#value-expression-for" },
        { "include": "#value-expression-fun" },
        { "include": "#value-expression-block-or-record-or-object" },
        { "include": "#value-expression-label" },
        { "include": "#value-expression-parens" },
        { "include": "#value-expression-switch" },
        { "include": "#value-expression-try" },
        { "include": "#value-expression-while" }
      ]
    },
    "value-expression-block": {
      "begin": "\\{",
      "end": "(?=\\})",
      "patterns": [
        { "include": "#value-expression-block-item" }
      ]
    },
    "value-expression-block-item": {
      "patterns": [
        { "include": "#module-item-let" },
        { "include": "#module-item-open" },
        { "include": "#value-expression" }
      ]
    },
    "value-expression-block-look": {
      "begin": "(?![[:space:]]*($|\\.\\.\\.|([[:upper:]][[:word:]]*\\.)*([[:lower:]][[:word:]]*)[[:space:]]*(?:,|:(?![=]))))",
      "end": "(?=\\})",
      "patterns": [
        { "include": "#value-expression-block-item" }
      ]
    },
    "value-expression-block-or-record-or-object": {
      "begin": "\\{",
      "end": "\\}",
      "patterns": [
        { "include": "#comment" },
        { "include": "#module-expression-path-prefix-simple" },
        { "include": "#value-expression-object-look" },
        { "include": "#value-expression-record-look" },
        { "include": "#value-expression-block-look" }
      ]
    },
    "value-expression-builtin": {
      "name": "keyword.operator",
      "match": "\\b(assert|decr|failwith|fprintf|incr|lazy|lor|lsl|lsr|lxor|mod|new|not|printf|ref)\\b"
    },
    "value-expression-for": {
      "begin": "(?=\\b(for)\\b)",
      "end": "\\}",
      "patterns": [
        { "include": "#value-expression-for-head" },
        { "include": "#value-expression-block" }
      ]
    },
    "value-expression-for-head": {
      "begin": "(?=\\b(for)\\b)",
      "end": "(?=\\{)",
      "beginCaptures": {
        "1": { "name": "keyword.control.reason" }
      },
      "patterns": [
        {
          "begin": "\\b(for)\\b",
          "end": "(?=\\b(in)\\b)",
          "beginCaptures": {
            "1": { "name": "keyword.control" }
          },
          "patterns": [
            { "include": "#pattern-variable" }
          ]
        },
        {
          "begin": "\\b(in)\\b",
          "end": "(?=(down)?to)",
          "beginCaptures": {
            "1": { "name": "keyword.control" }
          },
          "patterns": [
            { "include": "#value-expression" }
          ]
        },
        {
          "begin": "\\b((down)?to)\\b",
          "end": "(?=\\{)",
          "beginCaptures": {
            "1": { "name": "keyword.control" }
          },
          "patterns": [
            { "include": "#value-expression" }
          ]
        }
      ]
    },
    "value-expression-fun": {
      "begin": "\\b(fun)\\b",
      "end": "(?=[;\\)\\}]|\\b(and)\\b)",
      "beginCaptures": {
        "1": { "name": "keyword.operator.reason" }
      },
      "patterns": [
        { "include": "#value-expression-fun-pattern-match-rule" }
      ]
    },
    "value-expression-fun-pattern-match-rule": {
      "begin": "(\\|)?",
      "end": "(?=[;\\)\\}\\|]|\\b(and)\\b)",
      "beginCaptures": {
        "1": { "name": "keyword.operator.reason" }
      },
      "patterns": [
        { "include": "#value-expression-fun-pattern-match-rule-lhs" },
        { "include": "#value-expression-fun-pattern-match-rule-rhs" }
      ]
    },
    "value-expression-fun-pattern-match-rule-lhs": {
      "begin": "(?<=fun|[\\|])",
      "end": "(?==>)",
      "patterns": [
        { "include": "#module-item-let-value-param" }
      ]
    },
    "value-expression-fun-pattern-match-rule-rhs": {
      "begin": "(=>)",
      "end": "(?=[;\\)\\}\\|]|\\b(and)\\b)",
      "beginCaptures": {
        "1": { "name": "keyword.operator.reason" }
      },
      "patterns": [
        { "include": "#value-expression" }
      ]
    },
    "value-expression-if-then-else": {
      "begin": "\\b(if)\\b",
      "end": "(?=[;\\)\\]\\}])",
      "applyEndPatternLast": true,
      "beginCaptures": {
        "1": { "name": "keyword.control" }
      },
      "patterns": [
        {
          "begin": "\\b(else)\\b",
          "end": "(?=[;\\)\\]\\}])",
          "beginCaptures": {
            "1": { "name": "keyword.control" }
          },
          "patterns": [
            { "include": "#value-expression" }
          ]
        },
        { "include": "#value-expression-atomic" }
      ]
    },
    "value-expression-lazy": {
      "comment": "FIXME",
      "match": "\\b(lazy)\\b",
      "captures": {
        "1": { "name": "keyword.other" }
      }
    },
    "value-expression-label": {
      "begin": "\\b([_[:lower:]][[:word:]]*)\\b[[:space:]]*(::)(\\?)?",
      "end": "(?![[:space:]])",
      "beginCaptures": {
        "1": { "name": "constant.language" },
        "2": { "name": "keyword.other" },
        "3": { "name": "storage.type" }
      },
      "patterns": [
        { "include": "#value-expression" }
      ]
    },
    "value-expression-literal": {
      "patterns": [
        { "include": "#value-expression-literal-boolean" },
        { "include": "#value-expression-literal-char" },
        { "include": "#value-expression-literal-constructor-variant" },
        { "include": "#value-expression-literal-constructor-variant-polymorphic" },
        { "include": "#value-expression-lazy" },
        { "include": "#value-expression-literal-numeric" },
        { "include": "#value-expression-literal-string" },
        { "include": "#value-expression-literal-unit" }
      ]
    },
    "value-expression-literal-boolean": {
      "name": "constant.language.boolean.reason",
      "match": "\\b(false|true)\\b"
    },
    "value-expression-literal-char": {
      "match": "'([[:graph:]]|\\\\[\\\\\"'ntbr ]|\\\\[0-9][0-9][0-9]|\\\\x[0-9A-Fa-f][0-9A-Fa-f]|\\\\o[0-3][0-7][0-7])'",
      "name": "constant.character"
    },
    "value-expression-literal-constructor-variant": {
      "match": "\\b([[:upper:]][[:word:]]*)\\b(?!\\.)",
      "captures": {
        "1": { "name": "constant.language.reason" }
      }
    },
    "value-expression-literal-constructor-variant-polymorphic": {
      "match": "(`)([[:alpha:]][[:word:]]*)\\b(?!\\.)",
      "captures": {
        "1": { "name": "variable.parameter" },
        "2": { "name": "constant.language.reason" }
      }
    },
    "value-expression-literal-list": {
      "begin": "(\\[)(?![@%])",
      "end": "(\\])",
      "beginCaptures": {
        "1": { "name": "constant.language.list.reason" }
      },
      "endCaptures": {
        "1": { "name": "constant.language.list.reason" }
      },
      "patterns": [
        { "include": "#value-expression-literal-list-separator" },
        { "include": "#value-expression" },
        { "include": "#value-expression-literal-list" }
      ]
    },
    "value-expression-literal-list-separator": {
      "match": "(,)|(\\.\\.\\.)",
      "captures": {
        "1": { "name": "keyword.operator" },
        "2": { "name": "constant.language" }
      }
    },
    "value-expression-literal-numeric": {
      "name": "constant.language.numeric.reason",
      "match": "\\b(?<=[^$])((0(x|X)[0-9a-fA-F]+)|(0(o|O)[0-7]+)|(0(b|B)(0|1)+)|(([0-9]+(\\.[0-9]+)?))([eE]([+-]?)[0-9]+(\\.[0-9]+)?)?)\\b"
    },
    "value-expression-literal-string": {
			"name": "string.double.reason",
			"begin": "\"",
			"end": "\"|(?:[^\\\\\\n]$)",
      "patterns": [
        {
          "comment": "FIXME: make escapes into separate rule",
          "match": "\\\\[\\\\\"'ntbr ]|\\\\[0-9][0-9][0-9]|\\\\x[0-9A-Fa-f][0-9A-Fa-f]|\\\\o[0-3][0-7][0-7]",
          "name": "constant.character"
        },
        {
          "match": "(@)([ \\[\\],.]|\\\\n)",
          "captures": {
            "1": { "name": "keyword.operator" },
            "2": { "name": "constant.language" }
          }
        },
        {
          "match": "(%)\\b(identity)\\b",
          "captures": {
            "1": { "name": "keyword.operator" },
            "2": { "name": "constant.language" }
          }
        },
        {
          "comment": "FIXME: don't highlight in external strings",
          "match": "(%)([ads])?",
          "captures": {
            "1": { "name": "keyword.operator" },
            "2": { "name": "variable.parameter" }
          }
        }
      ]
    },
    "value-expression-literal-unit": {
      "match": "\\(\\)",
      "name": "constant.language.unit.reason"
    },
    "value-expression-object-look": {
      "comment": "FIXME: is there a better way than listing all the keywords?",
      "begin": "(?:\\G|^)[[:space:]]*(?=method)",
      "end": "(?=\\})",
      "patterns": [
        { "include": "#object-item" }
      ]
    },
    "value-expression-parens": {
      "begin": "(?=\\()",
      "end": "\\)",
      "patterns": [
        { "include": "#value-expression-parens-lhs" },
        { "include": "#type-annotation-rhs" }
      ]
    },
    "value-expression-parens-lhs": {
      "begin": "(?:\\(|(,))",
      "end": "(?=(?:[,:\\)]|\\b(as)\\b))",
      "beginCaptures": {
        "1": { "name": "keyword.operator" }
      },
      "patterns": [
        {
          "begin": "\\b(module)\\b",
          "end": "(?=\\))",
          "beginCaptures": {
            "1": { "name": "keyword.other" }
          },
          "patterns": [
            { "include": "#module-expression-path" }
          ]
        },
        { "include": "#value-expression" }
      ]
    },
    "value-expression-record": {
      "begin": "\\{",
      "end": "\\}",
      "patterns": [
        { "include": "#value-expression-record-item" }
      ]
    },
    "value-expression-record-field": {
      "begin": "(\\.\\.\\.)?\\b([_[:lower:]][[:word:]]*)",
      "end": "(?:(,)|(?=\\}))",
      "beginCaptures": {
        "1": { "name": "keyword.other" },
        "2": { "name": "constant.language.field.reason" }
      },
      "endCaptures": {
        "1": { "name": "keyword.operator.reason" }
      },
      "patterns": [
        {
          "begin": "\\G(:)",
          "end": "(?=[,\\}])",
          "beginCaptures": {
            "1": { "name": "keyword.operator.reason" }
          },
          "patterns": [
            { "include": "#value-expression" }
          ]
        }
      ]
    },
    "value-expression-record-item": {
      "patterns": [
        { "include": "#module-expression-path-prefix-simple" },
        { "include": "#value-expression-record-field" }
      ]
    },
    "value-expression-record-path": {
      "begin": "\\b[[:lower:]][[:word:]]*\\b",
      "end": "(?!\\.)",
      "patterns": [
        {
          "match": "(\\.)[[:space:]]*\\(([[:lower:]][[:word:]]*)\\)",
          "captures": {
            "1": { "name": "keyword.operator" },
            "2": { "name": "variable.parameter" }
          }
        },
        {
          "match": "(\\.)[[:space:]]*\\b([[:upper:]][[:word:]]*)\\b",
          "captures": {
            "1": { "name": "keyword.operator" },
            "2": { "name": "entity.name.class" }
          }
        },
        {
          "match": "(\\.)[[:space:]]*\\b([[:lower:]][[:word:]]*)\\b",
          "captures": {
            "1": { "name": "keyword.operator" },
            "2": { "name": "constant.language" }
          }
        }
      ]
    },
    "value-expression-switch": {
      "begin": "(?=\\b(switch)\\b)",
      "end": "\\}",
      "patterns": [
        { "include": "#value-expression-switch-head" },
        { "include": "#value-expression-switch-body" }
      ]
    },
    "value-expression-switch-head": {
      "begin": "\\b(switch)\\b",
      "end": "(?=\\{)",
      "beginCaptures": {
        "1": { "name": "keyword.control.reason" }
      },
      "patterns": [
        {
          "comment": "FIXME: parens; anchor",
          "include": "#value-expression"
        }
      ]
    },
    "value-expression-switch-body": {
      "begin": "\\{",
      "end": "(?=\\})",
      "patterns": [
        { "include": "#comment" },
        { "include": "#value-expression-switch-pattern-match-rule" }
      ]
    },
    "value-expression-switch-pattern-match-rule": {
      "patterns": [
        { "include": "#value-expression-switch-pattern-match-rule-lhs" },
        { "include": "#value-expression-switch-pattern-match-rule-rhs" }
      ]
    },
    "value-expression-switch-pattern-match-rule-lhs": {
      "begin": "(\\|)",
      "end": "(?==>)",
      "beginCaptures": {
        "1": { "name": "keyword.operator.reason" }
      },
      "patterns": [
        { "include": "#pattern-guard" },
        { "include": "#pattern" }
      ]
    },
    "value-expression-switch-pattern-match-rule-rhs": {
      "begin": "(=>)",
      "end": "(?=[\\|\\}])",
      "beginCaptures": {
        "1": { "name": "keyword.operator.reason" }
      },
      "patterns": [
        { "include": "#comment" },
        { "include": "#value-expression-block-item" }
      ]
    },
    "value-expression-try": {
      "begin": "(?=\\b(try)\\b)",
      "end": "\\}",
      "patterns": [
        { "include": "#value-expression-try-head" },
        { "include": "#value-expression-try-body" }
      ]
    },
    "value-expression-try-head": {
      "begin": "\\b(try)\\b",
      "end": "(?=\\{)",
      "beginCaptures": {
        "1": { "name": "keyword.control.reason" }
      },
      "patterns": [
        { "include": "#value-expression" }
      ]
    },
    "value-expression-try-body": {
      "begin": "\\{",
      "end": "(?=\\})",
      "patterns": [
        { "include": "#comment" },
        { "include": "#value-expression-switch-pattern-match-rule" }
      ]
    },
    "value-expression-while": {
      "begin": "(?=\\b(while)\\b)",
      "end": "\\}",
      "patterns": [
        { "include": "#value-expression-while-head" },
        { "include": "#value-expression-block" }
      ]
    },
    "value-expression-while-head": {
      "begin": "\\b(while)\\b",
      "end": "(?=\\{)",
      "beginCaptures": {
        "1": { "name": "keyword.control.reason" }
      },
      "patterns": [
        {
          "comment": "FIXME: parens; anchor",
          "include": "#value-expression"
        }
      ]
    },
    "value-expression-record-look": {
      "begin": "(?=\\.\\.\\.|([[:upper:]][[:word:]]*\\.)*([[:lower:]][[:word:]]*)[[:space:]]*[,:\\}])",
      "end": "(?=\\})",
      "patterns": [
        { "include": "#value-expression-record-item" }
      ]
    }
  }
}
